<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<!--
	CREATED BY : PRAVEEN
	DATE : 17-09-24
-->

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css"
	href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/font-awesome/5.9.0/css/all.min.css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
	th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script src="/webjars/jquery/3.4.1/jquery.min.js"
	th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
	th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>

<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
	th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>

<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
	th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>

<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script
	src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>




<style>
body {
	font-size: 0.8rem;
}

.btn {
	line-height: 0.5rem;
}

.table-bordered td, .table-bordered th {
	font-size: smaller;
}

.container-manager {
	width: 83.5%;
	padding-right: 15px;
	padding-left: 15px;
	margin-right: auto;
	margin-left: 17.3%;
	margin-top: 80px;
	margin-top: 80px;
}

.table .thead-light th {
	color: #495057;
	background-color: #e9ecef;
	border-color: #dee2e6;
	width: 23px;
}

.tablinks {
	background-color: #f2f2f2;
	color: #000;
}

.tablinks.active {
	background-color: #007bff;
	color: #fff;
}

.tab {
	overflow: hidden;
	border: 1px solid #ccc;
	background-color: #f1f1f1;
}

.scroll {
	max-height: 60vh;
	overflow-y: scroll;
	overflow-x: hidden;
}

.tab button {
	background-color: inherit;
	float: left;
	border: none;
	outline: none;
	cursor: pointer;
	padding: 14px 16px;
	transition: 0.3s;
	font-size: 17px;
}

.tab button:hover {
	background-color: #ddd;
}

.tabcontent {
	display: none;
	padding: 6px 12px;
	border: 0px solid #ccc;
	border-top: none;
}

#myPieChart {
	width: 100px;
	height: 100px;
}

.no-border {
	border: none !important;
}
</style>
<style>
.modal {
	display: none;
	position: fixed;
	z-index: 1;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	overflow: auto;
	background-color: rgba(0, 0, 0, 0.4);
	margin-left: 350px;
}

.modal-content {
	background-color: #fefefe;
	margin: 15% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 70%;
	height: 50%;
	margin-left: 200px;
}

.modal-pass {
	background-color: #fefefe;
	margin: 15% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 40%;
	height: 25%;
	margin-left: 400PX;
	margin-right: auto;
	border-radius: 10px;
	box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2);
	font-family: Arial, sans-serif;
}

.close {
	color: red;
	font-size: 28px;
	font-weight: bold;
}

.close:hover, .close:focus {
	color: black;
	text-decoration: none;
	cursor: pointer;
}

table {
	width: 100%;
	border-collapse: collapse;
}

thead {
	position: sticky;
	top: 0;
	background-color: #f9f9f9;
	z-index: 10;
}

th, td {
	padding: 12px;
	text-align: left;
	border-bottom: 1px solid #ddd;
}
</style>
<style>
.password-info {
	visibility: hidden;
	width: 320px;
	background-color: #333;
	color: #fff;
	text-align: left;
	border-radius: 10px;
	padding: 10px;
	position: absolute;
	z-index: 1;
	top: calc(100% + 10px);
	left: 50%;
	transform: translateX(-50%);
	opacity: 0;
	transition: opacity 0.3s;
}

input:hover+.password-info {
	visibility: visible;
	opacity: 0.8;
}

.table-responsive {
	height: 600px;
	overflow-y: auto;
}

.filterable .filters input[disabled] {
	background-color: transparent;
	border: none;
	cursor: auto;
	box-shadow: none;
	padding: 0;
	height: auto;
}

.filterable .filters input[disabled]::-webkit-input-placeholder {
	color: #333;
}

.filterable .filters input[disabled]::-moz-placeholder {
	color: #333;
}

.filterable .filters input[disabled]:-ms-input-placeholder {
	color: #333;
}

.filterable .filters input[disabled]::-webkit-input-placeholder {
	color: #333;
}
</style>


<script>
	function Home() {

		location.href = 'Dashboard';
	}

	function back() {
		window.history.back();
	}

	$(function() {
		$(
				"#doj,#dob,#date_of_offer,#date_of_appointment_letter,#aed,#ped,#dsd,#ded")
				.datepicker({
					dateFormat : "dd-mm-yy",
					changeMonth : true,
					changeYear : true

				});
	});
</script>
<script>
	function voucherGenerator() {

		location.href = './voucherMaintanace?formmode=generator';
	}

	function voucherUpload() {

		location.href = './voucherMaintanace?formmode=list';
	}

	function list() {

		location.href = './assosiateProfile?formmode=list';
	}
</script>

<script>
	function enquiryuser(a) {
		var acctno = a.getAttribute("data-attr");
		location.href = 'accountLedger?formmode=view&acct_num=' + acctno;
	}
	
	 document.addEventListener("DOMContentLoaded", function() {
	        const dateInput = document.getElementById("incomedate");
	        const today = new Date().toISOString().split('T')[0];
	        dateInput.value = today;
	    });
	 
	 document.addEventListener("DOMContentLoaded", function() {
		    const dateInput = document.getElementById("incomedate");
		    const trandateGet = document.getElementById("trandateget").value;
		    
		    // Convert 'dd-MM-yyyy' to 'yyyy-MM-dd' format
		    const parts = trandateGet.split("-");
		    const formattedDate = `${parts[2]}-${parts[1]}-${parts[0]}`;

		    // Set the formatted date to the date input
		    dateInput.value = formattedDate;
		});
</script>
<script>
$(document).ready(function() {
    $('#incomedate').on('change', function() {
    
        const balancedate = this.value; // Store the selected date
        console.log('Selected Date:', balancedate);

        $.ajax({
            url: './incomexpenditure',
            data: { balancedate: balancedate },
            type: 'GET',
            success: function(data) {
                console.log('Data received:', data);

                // Clear the tables before appending new rows
                $('#profit').empty();
                $('#loss').empty();

                // Check if data.msg exists for income
               let totalBalance = 0;
                if (data.msg) {
                     // Initialize the total balance variable

                    // Iterate through each item in the data.msg array
                    data.msg.forEach(trial => {
                        const row = document.createElement('tr');

                        // Format the balance for display
                        let formattedBalance = trial.tran_date_bal == 0 ? '0.00' : Number(trial.tran_date_bal.toString().replace('-', '')).toLocaleString(undefined, {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });

                        // Calculate the total balance, treating negative balances correctly
                        totalBalance += parseFloat(trial.tran_date_bal.toString().replace('-', '')) || 0;

                        // Combine GL code and description
                        const combinedCodeDesc = trial.glsh_code + ' - ' + trial.glsh_desc;

                        // Set the inner HTML for the new row
                        row.innerHTML = `
                            <td>${combinedCodeDesc}</td>
                            <td>${trial.acct_num}</td>
                            <td>${trial.acct_name}</td>
                            <td>${trial.acct_crncy}</td>
                            <td style="text-align: right;">${formattedBalance}</td>
                        `;

                        // Append the newly created row to the table with ID 'profit'
                        $('#profit').append(row);
                    });

                    // Format the total balance for display with commas and two decimal places
                    const formattedTotalBalance = totalBalance.toLocaleString(undefined, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });

                    document.getElementById('totalAmount').textContent = formattedTotalBalance;
                }

                // Check if data.msg1 exists for liabilities
                let totalBalance1 = 0;
                if (data.msg1) {
                     // Initialize the total balance variable for liabilities

                    data.msg1.forEach(trial => {
                        const row = document.createElement('tr');

                        // Format the balance for display
                        let formattedBalance = trial.tran_date_bal == 0 ? '0.00' : Number(trial.tran_date_bal.toString().replace('-', '')).toLocaleString(undefined, {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });

                        // Calculate the total balance for liabilities
                        totalBalance1 += parseFloat(trial.tran_date_bal.toString().replace('-', '')) || 0;

                        // Combine GL code and description
                        const combinedCodeDesc = trial.glsh_code + ' - ' + trial.glsh_desc;

                        // Set the inner HTML for the new row
                        row.innerHTML = `
                            <td>${combinedCodeDesc}</td>
                            <td>${trial.acct_num}</td>
                            <td>${trial.acct_name}</td>
                            <td>${trial.acct_crncy}</td>
                            <td style="text-align: right;">${formattedBalance}</td>
                        `;

                        // Append the newly created row to the table with ID 'loss'
                        $('#loss').append(row);
                    });

                    // Format the total balance for display with commas and two decimal places
                    const formattedTotalBalance1 = totalBalance1.toLocaleString(undefined, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });

                    document.getElementById('totalAcctBal').textContent = formattedTotalBalance1;
                }

             // Calculate the difference between total balances
                const numericTotalBalance = parseFloat(totalBalance.toFixed(2)) || 0;
                const numericTotalLiabilityBalance = parseFloat(totalBalance1.toFixed(2)) || 0;
                const difference = numericTotalBalance - numericTotalLiabilityBalance;
                const absoluteDifference = Math.abs(difference).toLocaleString(undefined, {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });

                // Determine profit or loss
                let statusMessage = '';
                let totalBalance2 = '';
                const statusMessageElement = document.getElementById('statusMessage'); 
                console.log("Difference:", difference); // Debugging log
                if (difference > 0) {
                    statusMessage = 'Profit';
                    statusMessageElement.style.color = 'green';
                    totalBalance2 = `Profit Amount: ${absoluteDifference}`;
                } else if (difference < 0) {
                    statusMessage = 'Loss';
                    statusMessageElement.style.color = 'red';
                    totalBalance2 = `Loss Amount: ${absoluteDifference}`;
                } else {
                    statusMessage = 'Break-even';
                    statusMessageElement.style.color = 'black';
                    totalBalance2 = 'No Profit or Loss';
                }

                // Display the result
                console.log(statusMessage);
                console.log("Total Balance 2:", totalBalance2); // Debugging log

                // Update the UI with the status message
                document.getElementById('statusMessage').textContent = statusMessage;
                document.getElementById('totalBalance2').textContent = totalBalance2; 
            },
            error: function(err) {
                console.error('Error fetching data:', err);
            }
        });
    });
});

//Filter Table

$(document)
	.ready(
			function() {
				$('.filterable .btn-filter')
						.click(
								function() {
									var $panel = $(this).parents(
											'.filterable'), $filters = $panel
											.find('.filters input'), $tbody = $panel
											.find('.table tbody');
									if ($filters.prop('disabled') == true) {
										$filters
												.prop('disabled', false);
										$filters.first().focus();
									} else {
										$filters.val('').prop(
												'disabled', true);
										$tbody.find('.no-result')
												.remove();
										$tbody.find('tr').show();
									}
								});

				$('.filterable .filters input')
						.keyup(
								function(e) {
									/* Ignore tab key */
									var code = e.keyCode || e.which;
									if (code == '9')
										return;
									/* Useful DOM data and selectors */
									var $input = $(this), inputContent = $input
											.val().toLowerCase(), $panel = $input
											.parents('.filterable'), column = $panel
											.find('.filters th')
											.index($input.parents('th')), $table = $panel
											.find('.table'), $rows = $table
											.find('tbody tr');
									/* Dirtiest filter function ever ;) */
									var $filteredRows = $rows
											.filter(function() {
												var value = $(this)
														.find('td').eq(
																column)
														.text()
														.toLowerCase();
												return value
														.indexOf(inputContent) === -1;
											});
									/* Clean previous no-result if exist */
									$table.find('tbody .no-result')
											.remove();
									/* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
									$rows.show();
									$filteredRows.hide();
									/* Prepend no-result row if all rows are filtered */
									if ($filteredRows.length === $rows.length) {
										$table
												.find('tbody')
												.prepend(
														$('<tr class="no-result text-center"><td colspan="'
																+ $table
																		.find('.filters th').length
																+ '">No result found</td></tr>'));
									}
								});
			});


</script>



</head>


<body>

	<div class="col-sm-2">
		<div th:insert="BGLSHeaderMenu :: header"></div>
	</div>


	<div class="container-manager ">
		<div class="row ">
			<div class="col-sm-6 mt-2">

				<div th:if="${formmode}=='list'">
					<div class="panel panel-primary filterable">
						<div class="card w-100 border panel panel-primary filterable">
							<div class="card-header" style="background-color: #e9ecef">
								<div class="float-left"
									style="display: flex; margin-left: -10px; justify-content: space-between; align-items: center;">
									<h5>INCOME</h5>
									<h4 style="margin-left: 170px">PROFIT AND LOSS ACCOUNT</h4>

								</div>
								<div class="float-right">
									<button type="button"
										class="btn btn-xs btn-primary btns p-2 border btn-filter">Filter</button>
								</div>

							</div>
							<div class="table-responsive">
								<table class="table table-bordered table-hover table-sm"
									style="margin-bottom: 0px; font-size: initial;" id="usertable">
									<thead class="thead-light">
										<tr class="filters">
											<th style="width: 25%"><input type="text"
												class="form-control font-weight-bold" placeholder="GL HEAD"
												disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="ACCT NO"
												disabled></th>
											<th style="width: 40%"><input type="text"
												class="form-control font-weight-bold"
												placeholder="ACCT NAME" disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="CUR"
												disabled></th>
											<th style="text-align: right"><input type="text"
												class="form-control font-weight-bold"
												style="text-align: right" placeholder="AMOUNT" disabled>
											</th>
										</tr>

									</thead>
									<tbody id="profit">
										<tr th:each="chartacc : ${balancesheet3}">
											<td
												th:text="${chartacc?.glsh_code + ' - ' + chartacc?.glsh_desc}"
												style="text-align: left;"></td>
											<td th:text="${chartacc?.acct_num}" style="text-align: left;"></td>
											<td th:text="${chartacc?.acct_name}"></td>
											<td th:text="${chartacc?.acct_crncy}"></td>
											<td style="text-align: right;"><span
												th:text="${chartacc.acct_bal == 0 ? '0.00' : #numbers.formatDecimal(chartacc.acct_bal.toString().replace('-', ''), 0, 'COMMA', 2, 'POINT')}"></span>
											</td>
										</tr>
										<!-- Placeholder for the total row -->

									</tbody>
								</table>

							</div>

							<div class="row-formline"
								style="display: flex; align-items: right; justify-content: right; margin-right: 30px; margin-top: 10px; margin-bottom: 10px">

								<div
									style="text-align: center; margin-right: 200px; font-weight: bold;">Total:</div>
								<div id="totalAmount"
									style="text-align: center; font-weight: bold;"></div>
							</div>

							<div class="card-footer text-center border-top-0"
								style="background-color: #e9ecef">
								<button type="button" class="btn btn-xs btn-primary mr-2"
									id="btnHome" onclick="Home();">Home</button>

							</div>

						</div>
					</div>
				</div>
			</div>


			<div class="col-sm-6 mt-2">
				<div class="float-right"></div>
				<div th:if="${formmode}=='list'">
					<div class="panel panel-primary filterable">
						<div class="card w-100 border panel panel-primary filterable">
							<div class="card-header" style="background-color: #e9ecef">
								<div class="d-flex justify-content-between align-items-center">
									<h5 class=" mb-0">EXPENDITURE</h5>
									<div class="d-flex align-items-center">
										<input type="date" name="incomedate" id="incomedate"
											class="form-control form-control-sm bg-white border border-dark mr-2" />
										<input type="text" id="trandateget"
											th:value="${#dates.format(TRANDATE, 'dd-MM-yyyy')}"
											class="form-control font-weight-bold" placeholder="HEAD"
											hidden>
										<button type="button"
											class="btn btn-xs btn-primary btns p-2 border btn-filter">Filter</button>
									</div>
								</div>
							</div>
							<div class="table-responsive">
								<table class="table  table-bordered  table-hover table-sm"
									style="margin-bottom: 0px; font-size: initial;" id="usertable">
									<thead class="thead-light">
										<tr class="filters">
											<th style="width: 25%"><input type="text"
												class="form-control font-weight-bold" placeholder="GL HEAD"
												disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="ACCT NO"
												disabled></th>
											<th style="width: 45%"><input type="text"
												class="form-control font-weight-bold"
												placeholder="ACCT NAME" disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="CUR"
												disabled></th>
											<th style="text-align: right"><input type="text"
												class="form-control font-weight-bold"
												style="text-align: right" placeholder="AMOUNT" disabled>
											</th>
										</tr>

									</thead>
									<tbody id="loss">
										<tr th:each="chartacc : ${balancesheet4}">
											<td
												th:text="${chartacc?.glsh_code + ' - ' + chartacc?.glsh_desc}"
												style="text-align: left;"></td>
											<td th:text="${chartacc?.acct_num}" style="text-align: left;"></td>
											<td th:text="${chartacc?.acct_name}"
												style="overflow: visible;"></td>
											<td th:text="${chartacc?.acct_crncy}"></td>
											<td style="text-align: right;"><span
												th:text="${chartacc.acct_bal == 0 ?   '0.00' : #numbers.formatDecimal(chartacc.acct_bal.toString().replace('-', ''), 0, 'COMMA', 2, 'POINT')}"></span></td>
										</tr>

									</tbody>

								</table>
							</div>

							<div class="row-formline"
								style="display: flex; align-items: right; justify-content: right; margin-right: 30px; margin-top: 10px; margin-bottom: 10px">

								<div
									style="text-align: center; font-weight: bold; margin-right: 200px;">Total:</div>
								<div id="totalAcctBal"
									style="text-align: center; font-weight: bold;"></div>
							</div>



							<div class="card-footer text-center border-top-0"
								style="background-color: #e9ecef">

								<button type="button" class="btn btn-xs btn-primary ml-2"
									id="btnBack" onclick="back();">Back</button>
							</div>



						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-12 mt-2" style="font-size: 20px">
				<div class="row formline">
					<br>
					<div class="col-sm-5"></div>
					<div
						style="text-align: center; font-weight: bold; margin-top: 10px;">Report
						Status :</div>
					<div id="statusMessage"
						style="text-align: center; font-weight: bold; margin-left: 10px; margin-top: 10px;"></div>
				</div>
				<div class="row formline">
					<br>
					<div class="col-sm-5"></div>
					<div id="totalBalance2"
						style="text-align: center; font-weight: bold;"></div>
				</div>
			</div>

		</div>
	</div>

	<script>
    function calculateAndCompare() {
        // Extract total amounts from the DOM and convert them to floats
        const totalProfit = parseFloat(document.getElementById('totalAmount').innerText.replace(/,/g, '')) || 0;
        const totalLoss = parseFloat(document.getElementById('totalAcctBal').innerText.replace(/,/g, '')) || 0;

        const difference = totalProfit - totalLoss;
        const absoluteDifference = Math.abs(difference).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        
        // Calculate the difference and determine the status
        const statusMessageElement = document.getElementById('statusMessage');
    const totalBalanceElement = document.getElementById('totalBalance2');
    
    if (difference > 0) {
        statusMessageElement.textContent = 'Profit';
        statusMessageElement.style.color = 'green';

        // Display the profit amount
        totalBalanceElement.textContent = `Profit Amount: ${absoluteDifference}`;       
    } else if (difference < 0) {
        statusMessageElement.textContent = 'Loss';
        statusMessageElement.style.color = 'red';

        // Display the loss amount
        
        totalBalanceElement.textContent = "Loss Amount \u00A0:" +"\u00A0 "+ `${absoluteDifference}`;

    } else {
        statusMessageElement.textContent = 'Break-even';
        statusMessageElement.style.color = 'black';

        // Indicate that the amounts are balanced
        totalBalanceElement.textContent = 'No Profit or Loss';
        }
    }

    // Call the function after the page loads
    window.onload = calculateAndCompare;
</script>

	<script>
	document.addEventListener('DOMContentLoaded', function () {
    calculateTotal();
    calculateTotal1();
});

function calculateTotal() {
    let total = 0;
    const rows = document.querySelectorAll('#profit tr');

    rows.forEach(row => {
        const amountCell = row.querySelector('td:nth-child(5) span');
        if (amountCell) {
            const amount = parseFloat(amountCell.textContent.replace(/,/g, '')) || 0;
            total += amount;
        }
    });

    // Update the total row with the calculated total
    document.getElementById('totalAmount').textContent = total.toLocaleString('en', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
}

function calculateTotal1() {
    let total = 0;
    const rows = document.querySelectorAll("#loss tr");

    rows.forEach(row => {
        const balanceCell = row.querySelector("td:nth-child(5) span"); // Select the span containing acct_bal
        if (balanceCell) {
            const balance = parseFloat(balanceCell.textContent.replace(/,/g, ''));
            if (!isNaN(balance)) {
                total += balance;
            }
        }
    });

    // Format the total with commas and two decimal points
    document.getElementById("totalAcctBal").textContent = total.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
}
	</script>

</body>

</html>